{%extends 'template.html' %}
{%block title%}é¦–é  - ç‰©å“ç®¡ç†ç³»çµ±{%endblock%}
{%block user%}{{User.User}}{%endblock%}

{%block contain%}
<div class="container-fluid">
  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header animate-fadeInUp">
    <h1>ğŸ  æˆ‘çš„ç‰©å“ç®¡ç†</h1>
    <p class="lead">è¼•é¬†è¨˜éŒ„å®¶ä¸­ç‰©å“ä½ç½®ï¼Œå†ä¹Ÿä¸æ€•æ‰¾ä¸åˆ°æ±è¥¿ï¼</p>
  </div>

  <!-- å¿«é€Ÿå…¥é–€æŒ‡å¼• (é¦–æ¬¡ä½¿ç”¨è€…æˆ–ç‰©å“ç‚ºç©ºæ™‚é¡¯ç¤º) -->
  {%if not items%}
  <div class="quick-start animate-fadeInUp stagger-1">
    <h3><i class="fas fa-rocket text-primary"></i> å¿«é€Ÿé–‹å§‹</h3>
    <div class="quick-start-steps">
      <a href="{{url_for('locations.manage_locations')}}" class="quick-start-step text-decoration-none">
        <div class="step-number">1</div>
        <div class="step-content">
          <h4>è¨­å®šä½ç½®</h4>
          <p>å»ºç«‹æ¨“å±¤ã€æˆ¿é–“ã€å€åŸŸç­‰ä½ç½®é¸é …</p>
        </div>
      </a>
      <a href="{{url_for('types.addtype')}}" class="quick-start-step text-decoration-none">
        <div class="step-number">2</div>
        <div class="step-content">
          <h4>å»ºç«‹é¡å‹</h4>
          <p>æ–°å¢ç‰©å“åˆ†é¡ï¼Œå¦‚é›»å­ç”¢å“ã€æ–‡å…·ç­‰</p>
        </div>
      </a>
      <a href="{{url_for('items.additem')}}" class="quick-start-step text-decoration-none">
        <div class="step-number">3</div>
        <div class="step-content">
          <h4>æ–°å¢ç‰©å“</h4>
          <p>æ‹ç…§ä¸¦è¨˜éŒ„ç‰©å“è³‡è¨Šå’Œæ”¾ç½®ä½ç½®</p>
        </div>
      </a>
      <a href="{{url_for('items.search')}}" class="quick-start-step text-decoration-none">
        <div class="step-number">4</div>
        <div class="step-content">
          <h4>é–‹å§‹ä½¿ç”¨</h4>
          <p>æœå°‹ç‰©å“ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‚¨éœ€è¦çš„æ±è¥¿</p>
        </div>
      </a>
    </div>
  </div>
  {%endif%}

  <!-- æœå°‹åŠŸèƒ½ -->
  <div class="search-form animate-fadeInUp stagger-2">
    <form action="{{ url_for('items.search') }}" method="GET" class="row g-3 align-items-end">
      <div class="col-12 col-md-3">
        <label class="form-label small text-muted mb-1">
          <i class="fas fa-font me-1"></i>ç‰©å“åç¨±
        </label>
        <input
          type="text"
          name="q"
          class="form-control"
          placeholder="è¼¸å…¥åç¨±æœå°‹..."
          value="{{ request.args.get('q', '') }}"
        />
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label small text-muted mb-1">
          <i class="fas fa-map-marker-alt me-1"></i>åœ°é»
        </label>
        <input
          type="text"
          name="place"
          class="form-control"
          placeholder="æ”¾ç½®åœ°é»..."
          value="{{ request.args.get('place', '') }}"
        />
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label small text-muted mb-1">
          <i class="fas fa-tag me-1"></i>é¡å‹
        </label>
        <select name="type" class="form-select">
          <option value="">å…¨éƒ¨é¡å‹</option>
          {% for type in itemtype %}
          <option value="{{type.name}}" {% if request.args.get('type','')==type.name %}selected{% endif %}>{{type.name}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-4 col-md-1">
        <label class="form-label small text-muted mb-1">æ¨“å±¤</label>
        <select name="floor" class="form-select">
          <option value="">å…¨éƒ¨</option>
          {% for f in floors %}
          <option value="{{f}}" {% if request.args.get('floor','')==f %}selected{% endif %}>{{f}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-4 col-md-1">
        <label class="form-label small text-muted mb-1">æˆ¿é–“</label>
        <select name="room" class="form-select">
          <option value="">å…¨éƒ¨</option>
          {% for r in rooms %}
          <option value="{{r}}" {% if request.args.get('room','')==r %}selected{% endif %}>{{r}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-4 col-md-1">
        <label class="form-label small text-muted mb-1">å€åŸŸ</label>
        <select name="zone" class="form-select">
          <option value="">å…¨éƒ¨</option>
          {% for z in zones %}
          <option value="{{z}}" {% if request.args.get('zone','')==z %}selected{% endif %}>{{z}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-12 col-md-2 d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1">
          <i class="fas fa-search me-1"></i>æœå°‹
        </button>
        <a href="{{ url_for('items.scan') }}" class="btn btn-outline-info" data-tooltip="æƒææ¢ç¢¼">
          <i class="fas fa-qrcode"></i>
        </a>
      </div>
    </form>
  </div>

  <!-- çµ±è¨ˆè³‡è¨Š -->
  <div class="row g-3 mb-4 animate-fadeInUp stagger-3">
    <div class="col-6 col-md-3">
      <div class="stats-card bg-primary text-white">
        <div class="icon"><i class="fas fa-box"></i></div>
        <h2>{{ stats.total if stats else (pagination.total if pagination else items|length) }}</h2>
        <h5>ç¸½ç‰©å“æ•¸</h5>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card bg-success text-white">
        <div class="icon"><i class="fas fa-image"></i></div>
        <h2>{{ stats.with_photo if stats else 0 }}</h2>
        <h5>æœ‰ç…§ç‰‡</h5>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card bg-info text-white">
        <div class="icon"><i class="fas fa-map-pin"></i></div>
        <h2>{{ stats.with_location if stats else 0 }}</h2>
        <h5>æœ‰ä½ç½®è¨˜éŒ„</h5>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stats-card bg-warning text-white">
        <div class="icon"><i class="fas fa-folder"></i></div>
        <h2>{{ stats.with_type if stats else 0 }}</h2>
        <h5>æœ‰åˆ†é¡</h5>
      </div>
    </div>
  </div>
</div>
{%endblock%}

{%block card%}
<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-4">
  {%for item in items%}
  <div class="col">
    <div class="card h-100">
      <!-- ç‰©å“åœ–ç‰‡ - é»æ“Šé€²å…¥è©³æƒ…é  -->
      <a href="{{ url_for('items.item_detail', item_id=item.ItemID) }}" class="card-img-link position-relative overflow-hidden d-block" style="height: 200px;">
        {%if item.ItemPic%}
        <img
          src="{{ url_for('items.uploaded_file', filename=item.ItemPic) }}"
          class="card-img-top h-100 w-100"
          alt="{{ item.ItemName }}"
          style="object-fit: cover"
          loading="lazy"
        />
        {%else%}
        <div class="card-img-top bg-gradient d-flex align-items-center justify-content-center h-100" 
             style="background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);">
          <i class="fas fa-image fa-4x text-white opacity-50"></i>
        </div>
        {%endif%}
        
        <!-- ç‹€æ…‹æ¨™ç±¤ -->
        <div class="position-absolute top-0 end-0 p-2 d-flex flex-column gap-1">
          {% if item.WarrantyStatus=='expired' %}
          <span class="badge bg-danger"><i class="fas fa-exclamation-triangle me-1"></i>ä¿å›ºéæœŸ</span>
          {% elif item.WarrantyStatus=='near' %}
          <span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>å³å°‡åˆ°æœŸ</span>
          {% endif %}
          {% if item.UsageStatus=='expired' %}
          <span class="badge bg-danger"><i class="fas fa-hourglass-end me-1"></i>ä½¿ç”¨éæœŸ</span>
          {% elif item.UsageStatus=='near' %}
          <span class="badge bg-warning text-dark"><i class="fas fa-hourglass-half me-1"></i>å³å°‡åˆ°æœŸ</span>
          {% endif %}
        </div>
        
        <!-- é¡å‹æ¨™ç±¤ -->
        {%if item.ItemType%}
        <div class="position-absolute bottom-0 start-0 p-2">
          <span class="badge bg-dark bg-opacity-75">
            <i class="fas fa-tag me-1"></i>{{item.ItemType}}
          </span>
        </div>
        {%endif%}
        
        <!-- æ‡¸åœæç¤º -->
        <div class="card-img-overlay d-flex align-items-center justify-content-center opacity-0 hover-overlay">
          <span class="badge bg-white text-dark fs-6">
            <i class="fas fa-eye me-1"></i>æŸ¥çœ‹è©³æƒ…
          </span>
        </div>
      </a>
      
      <!-- å¡ç‰‡å…§å®¹ -->
      <div class="card-body">
        <h5 class="card-title text-truncate" title="{{item.ItemName}}">
          {{item.ItemName}}
        </h5>
        <p class="card-text text-muted small mb-2">
          <i class="fas fa-hashtag me-1"></i>{{item.ItemID}}
        </p>
        
        {%if item.ItemStorePlace%}
        <p class="card-text small mb-1">
          <i class="fas fa-map-marker-alt text-danger me-1"></i>
          <strong>ä½ç½®ï¼š</strong>{{item.ItemStorePlace}}
        </p>
        {%endif%}
        
        {%if item.ItemFloor or item.ItemRoom or item.ItemZone%}
        <p class="card-text small mb-1">
          <i class="fas fa-home text-info me-1"></i>
          {{item.ItemFloor}} {{item.ItemRoom}} {{item.ItemZone}}
        </p>
        {%endif%}
        
        {%if item.ItemOwner%}
        <p class="card-text small mb-1">
          <i class="fas fa-user text-secondary me-1"></i>
          {{item.ItemOwner}}
        </p>
        {%endif%}
        
        {%if item.WarrantyExpiry%}
        <p class="card-text small mb-1">
          <i class="fas fa-shield-alt text-success me-1"></i>
          ä¿å›ºè‡³ {{item.WarrantyExpiry}}
        </p>
        {%endif%}
      </div>
      
      <!-- å¡ç‰‡åº•éƒ¨æ“ä½œ -->
      <div class="card-footer bg-transparent">
        <div class="d-flex justify-content-between align-items-center">
          <div class="btn-group btn-group-sm">
            {%if User.admin%}
            <a href="{{ url_for('items.edititem', item_id=item.ItemID) }}" 
               class="btn btn-outline-primary"
               data-tooltip="ç·¨è¼¯ç‰©å“">
              <i class="fas fa-edit"></i>
            </a>
            {%endif%}
            <a href="{{ url_for('items.search') }}?q={{item.ItemName}}" 
               class="btn btn-outline-secondary"
               data-tooltip="æœå°‹ç›¸ä¼¼">
              <i class="fas fa-search"></i>
            </a>
          </div>
          <div class="btn-group btn-group-sm">
            <a href="{{ url_for('items.qrcode_image', item_id=item.ItemID) }}" 
               class="btn btn-outline-dark"
               data-tooltip="ä¸‹è¼‰ QR Code">
              <i class="fas fa-qrcode"></i>
            </a>
            <a href="{{ url_for('items.barcode_image', item_id=item.ItemID) }}" 
               class="btn btn-outline-dark"
               data-tooltip="ä¸‹è¼‰æ¢ç¢¼">
              <i class="fas fa-barcode"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  {%endfor%}
</div>

{%if not items%}
<div class="empty-state animate-fadeInUp">
  <i class="fas fa-box-open"></i>
  <h3>é‚„æ²’æœ‰ä»»ä½•ç‰©å“</h3>
  <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹è¨˜éŒ„æ‚¨çš„ç¬¬ä¸€å€‹ç‰©å“å§ï¼</p>
  {%if User.admin%}
  <a href="{{ url_for('items.additem') }}" class="btn btn-primary btn-lg">
    <i class="fas fa-plus me-2"></i>æ–°å¢ç¬¬ä¸€å€‹ç‰©å“
  </a>
  {%endif%}
</div>
{%endif%}
{%endblock%}

{%block page%}
{% include "partials/pagination.html" %}
{%endblock%}
