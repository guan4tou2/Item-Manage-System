{%extends 'template.html' %}
{%block title%}åŒ¯å…¥ç‰©å“ - ç‰©å“ç®¡ç†ç³»çµ±{%endblock%}
{%block user%}{{User.User}}{%endblock%}

{%block contain%}
<div class="container">
  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header animate-fadeInUp">
    <h1>ğŸ“¥ åŒ¯å…¥ç‰©å“</h1>
    <p class="lead">å¾ JSON æˆ– CSV æª”æ¡ˆåŒ¯å…¥ç‰©å“è³‡æ–™</p>
  </div>
  
  <!-- éºµåŒ…å±‘å°èˆª -->
  <nav aria-label="breadcrumb" class="mb-4 animate-fadeInUp stagger-1">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{url_for('items.home')}}"><i class="fas fa-home"></i> é¦–é </a></li>
      <li class="breadcrumb-item"><a href="{{url_for('items.manageitem')}}">ç®¡ç†ç‰©å“</a></li>
      <li class="breadcrumb-item active">åŒ¯å…¥ç‰©å“</li>
    </ol>
  </nav>
</div>
{%endblock%}

{%block body%}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card animate-fadeInUp stagger-2">
        <div class="card-body p-4">
          <!-- åŒ¯å…¥è¡¨å–® -->
          <form action="{{ url_for('items.import_items') }}" method="post" enctype="multipart/form-data" id="importForm">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            
            <div class="upload-area" id="uploadArea">
              <input type="file" name="file" id="fileInput" accept=".json,.csv" class="d-none" required/>
              <div class="upload-placeholder" id="uploadPlaceholder">
                <i class="fas fa-cloud-upload-alt fa-4x text-primary mb-3"></i>
                <h4>æ‹–æ›³æª”æ¡ˆåˆ°æ­¤è™•æˆ–é»æ“Šé¸æ“‡</h4>
                <p class="text-muted mb-0">æ”¯æ´ JSON æˆ– CSV æ ¼å¼</p>
              </div>
              <div class="upload-preview d-none" id="uploadPreview">
                <i class="fas fa-file-alt fa-4x text-success mb-3"></i>
                <h4 id="fileName">å·²é¸æ“‡æª”æ¡ˆ</h4>
                <p class="text-muted mb-0" id="fileInfo">-</p>
                <button type="button" class="btn btn-sm btn-outline-danger mt-3" onclick="clearFile()">
                  <i class="fas fa-times me-1"></i>ç§»é™¤æª”æ¡ˆ
                </button>
              </div>
            </div>
            
            <div class="d-flex gap-2 justify-content-center mt-4">
              <button type="submit" class="btn btn-primary btn-lg" id="submitBtn" disabled>
                <i class="fas fa-upload me-2"></i>é–‹å§‹åŒ¯å…¥
              </button>
              <a href="{{ url_for('items.manageitem') }}" class="btn btn-secondary btn-lg">
                <i class="fas fa-arrow-left me-2"></i>è¿”å›
              </a>
            </div>
          </form>
        </div>
      </div>
      
      <!-- èªªæ˜å¡ç‰‡ -->
      <div class="row g-4 mt-4 animate-fadeInUp stagger-3">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>JSON æ ¼å¼</h5>
            </div>
            <div class="card-body">
              <p class="small text-muted mb-3">JSON é™£åˆ—æ ¼å¼ï¼Œæ¯å€‹ç‰©ä»¶ä»£è¡¨ä¸€å€‹ç‰©å“ï¼š</p>
              <pre class="bg-light p-3 rounded small mb-0"><code>[
  {
    "ItemID": "ITEM-001",
    "ItemName": "ç‰©å“åç¨±",
    "ItemType": "é›»å­ç”¢å“",
    "ItemStorePlace": "å®¢å»³é›»è¦–æ«ƒ",
    "ItemFloor": "1F",
    "ItemRoom": "å®¢å»³",
    "ItemZone": "é›»è¦–æ«ƒ",
    "ItemOwner": "æ“æœ‰è€…",
    "ItemGetDate": "2024-01-01",
    "WarrantyExpiry": "2025-01-01",
    "UsageExpiry": "",
    "ItemDesc": "æè¿°å…§å®¹"
  }
]</code></pre>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="fas fa-file-csv me-2"></i>CSV æ ¼å¼</h5>
            </div>
            <div class="card-body">
              <p class="small text-muted mb-3">ç¬¬ä¸€è¡Œç‚ºæ¬„ä½åç¨±ï¼š</p>
              <pre class="bg-light p-3 rounded small mb-0"><code>ItemID,ItemName,ItemType,...
ITEM-001,ç‰©å“åç¨±,é›»å­ç”¢å“,...
ITEM-002,å¦ä¸€å€‹ç‰©å“,æ–‡å…·,...
</code></pre>
              <div class="alert alert-info small mt-3 mb-0">
                <i class="fas fa-info-circle me-1"></i>
                å¯ä»¥å…ˆåŒ¯å‡ºç¾æœ‰è³‡æ–™ä½œç‚ºç¯„æœ¬
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- åŒ¯å‡ºé€£çµ -->
      <div class="card mt-4 animate-fadeInUp stagger-4">
        <div class="card-body">
          <h5><i class="fas fa-download me-2"></i>éœ€è¦ç¯„æœ¬ï¼Ÿ</h5>
          <p class="text-muted mb-3">å¯ä»¥å…ˆåŒ¯å‡ºç¾æœ‰è³‡æ–™ä½œç‚ºç¯„æœ¬ï¼Œæˆ–ç›´æ¥ä¸‹è¼‰ç©ºç™½ç¯„æœ¬ï¼š</p>
          <div class="import-export-group">
            <a href="{{ url_for('items.export_items', format='json') }}" class="btn btn-outline-primary">
              <i class="fas fa-file-code me-1"></i>åŒ¯å‡º JSON
            </a>
            <a href="{{ url_for('items.export_items', format='csv') }}" class="btn btn-outline-success">
              <i class="fas fa-file-csv me-1"></i>åŒ¯å‡º CSV
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.upload-area {
  border: 3px dashed var(--gray-300);
  border-radius: var(--radius-xl);
  padding: 4rem 2rem;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  background: var(--gray-50);
}

.upload-area:hover,
.upload-area.dragover {
  border-color: var(--primary);
  background: rgba(102, 126, 234, 0.05);
}

.upload-area.has-file {
  border-color: var(--success);
  background: rgba(25, 135, 84, 0.05);
}
</style>
{%endblock%}

{%block js%}
<script>
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const uploadPlaceholder = document.getElementById('uploadPlaceholder');
const uploadPreview = document.getElementById('uploadPreview');
const fileName = document.getElementById('fileName');
const fileInfo = document.getElementById('fileInfo');
const submitBtn = document.getElementById('submitBtn');

// é»æ“Šä¸Šå‚³å€åŸŸ
uploadArea.addEventListener('click', () => fileInput.click());

// æ‹–æ›³äº‹ä»¶
uploadArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadArea.classList.add('dragover');
});

uploadArea.addEventListener('dragleave', () => {
  uploadArea.classList.remove('dragover');
});

uploadArea.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadArea.classList.remove('dragover');
  
  const files = e.dataTransfer.files;
  if (files.length > 0) {
    const file = files[0];
    if (file.name.match(/\.(json|csv)$/i)) {
      fileInput.files = files;
      showFileInfo(file);
    } else {
      alert('è«‹é¸æ“‡ JSON æˆ– CSV æ ¼å¼çš„æª”æ¡ˆ');
    }
  }
});

// æª”æ¡ˆé¸æ“‡è®Šæ›´
fileInput.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) {
    showFileInfo(file);
  }
});

function showFileInfo(file) {
  fileName.textContent = file.name;
  const size = file.size < 1024 
    ? file.size + ' bytes'
    : (file.size / 1024).toFixed(1) + ' KB';
  fileInfo.textContent = `æª”æ¡ˆå¤§å°ï¼š${size}`;
  
  uploadPlaceholder.classList.add('d-none');
  uploadPreview.classList.remove('d-none');
  uploadArea.classList.add('has-file');
  submitBtn.disabled = false;
}

function clearFile() {
  fileInput.value = '';
  uploadPlaceholder.classList.remove('d-none');
  uploadPreview.classList.add('d-none');
  uploadArea.classList.remove('has-file');
  submitBtn.disabled = true;
}

// è¡¨å–®æäº¤
document.getElementById('importForm').addEventListener('submit', function() {
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>åŒ¯å…¥ä¸­...';
});
</script>
{%endblock%}

