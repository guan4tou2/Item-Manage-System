{%extends 'template.html' %}
{%block title%}ç”¨æˆ¶ç®¡ç† - ç‰©å“ç®¡ç†ç³»çµ±{%endblock%}
{%block user%}{{User.User}}{%endblock%}

{%block contain%}
<div class="container-fluid">
  <!-- é é¢æ¨™é¡Œ -->
  <div class="page-header animate-fadeInUp">
    <h1>ğŸ‘¥ ç”¨æˆ¶ç®¡ç†</h1>
    <p class="lead">ç®¡ç†ç³»çµ±ä½¿ç”¨è€…å¸³è™Ÿ</p>
  </div>
</div>
{%endblock%}

{%block body%}
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card animate-fadeInUp stagger-1">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-users me-2"></i>ç”¨æˆ¶åˆ—è¡¨</h5>
          <span class="badge bg-primary">å…± {{ users|length }} å€‹ç”¨æˆ¶</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>ç”¨æˆ¶åç¨±</th>
                  <th>è§’è‰²</th>
                  <th>å¯†ç¢¼ç‹€æ…‹</th>
                  <th>ç™»å…¥è³‡è¨Š</th>
                  <th class="text-end">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody>
                {%for u in users%}
                <tr>
                  <td>
                    <i class="fas fa-user me-2 text-muted"></i>
                    <strong>{{ u.User }}</strong>
                    {%if u.User == User.User%}
                    <span class="badge bg-info ms-2">æ‚¨</span>
                    {%endif%}
                  </td>
                  <td>
                    {%if u.admin%}
                    <span class="badge bg-danger">
                      <i class="fas fa-shield-alt me-1"></i>ç®¡ç†å“¡
                    </span>
                    {%else%}
                    <span class="badge bg-secondary">
                      <i class="fas fa-user me-1"></i>ä¸€èˆ¬ç”¨æˆ¶
                    </span>
                    {%endif%}
                  </td>
                  <td>
                    {%if u.password_changed%}
                    <span class="text-success">
                      <i class="fas fa-check-circle me-1"></i>å·²è¨­å®š
                    </span>
                    {%else%}
                    <span class="text-warning">
                      <i class="fas fa-exclamation-triangle me-1"></i>ä½¿ç”¨é è¨­
                    </span>
                    {%endif%}
                  </td>
                  <td>
                    {%if u.locked_until%}
                    <span class="text-danger">
                      <i class="fas fa-lock me-1"></i>å·²é–å®š
                    </span>
                    {%elif u.last_login%}
                    <small class="text-muted">
                      <i class="fas fa-clock me-1"></i>{{ u.last_login }}<br>
                      <i class="fas fa-globe me-1"></i>{{ u.last_login_ip or 'N/A' }}
                    </small>
                    {%else%}
                    <small class="text-muted">å°šæœªç™»å…¥</small>
                    {%endif%}
                  </td>
                  <td class="text-end">
                    <div class="btn-group btn-group-sm">
                      {%if u.locked_until and u.User != User.User%}
                      <form action="{{ url_for('auth.admin_unlock_user', target_user=u.User) }}" 
                            method="POST" 
                            class="d-inline">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-outline-success" title="è§£é–å¸³è™Ÿ">
                          <i class="fas fa-unlock"></i>
                        </button>
                      </form>
                      {%endif%}
                      
                      {%if u.User != User.User%}
                      <form action="{{ url_for('auth.admin_reset_password', target_user=u.User) }}" 
                            method="POST" 
                            class="d-inline"
                            onsubmit="return confirm('ç¢ºå®šè¦é‡ç½® {{ u.User }} çš„å¯†ç¢¼å—ï¼Ÿ');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-outline-warning" title="é‡ç½®å¯†ç¢¼">
                          <i class="fas fa-key"></i>
                        </button>
                      </form>
                      {%else%}
                      <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline-primary" title="ä¿®æ”¹å¯†ç¢¼">
                        <i class="fas fa-edit"></i>
                      </a>
                      {%endif%}
                    </div>
                  </td>
                </tr>
                {%endfor%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
      <!-- èªªæ˜ -->
      <div class="card mt-4 animate-fadeInUp stagger-2">
        <div class="card-body">
          <h6><i class="fas fa-info-circle me-2 text-primary"></i>å¯†ç¢¼é‡ç½®èªªæ˜</h6>
          <ul class="small text-muted mb-0">
            <li>é‡ç½®å¯†ç¢¼å¾Œï¼Œç³»çµ±æœƒç”¢ç”Ÿä¸€çµ„éš¨æ©Ÿå¯†ç¢¼ï¼ˆ12 ä½è‹±æ•¸æ··åˆï¼‰</li>
            <li>è«‹å°‡æ–°å¯†ç¢¼æä¾›çµ¦ç”¨æˆ¶ï¼Œç”¨æˆ¶ç™»å…¥å¾Œæœƒè¢«è¦æ±‚è¨­å®šæ–°å¯†ç¢¼</li>
            <li>ç®¡ç†å“¡ç„¡æ³•æŸ¥çœ‹å…¶ä»–ç”¨æˆ¶çš„å¯†ç¢¼</li>
            <li>å¦‚éœ€ä¿®æ”¹è‡ªå·±çš„å¯†ç¢¼ï¼Œè«‹ä½¿ç”¨ã€Œä¿®æ”¹å¯†ç¢¼ã€åŠŸèƒ½</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{%endblock%}

