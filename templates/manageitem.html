{%extends 'template.html' %} {%block title%}ç®¡ç†ç‰©å“ - ç‰©å“ç®¡ç†ç³»çµ±{%endblock%}
{%block user%}{{User.User}}{%endblock%} {%block contain%}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h1 class="display-5 text-center mb-4">ğŸ“¦ ç®¡ç†ç‰©å“</h1>
      <p class="lead text-center mb-5">ç®¡ç†æ‚¨çš„ç‰©å“è³‡è¨Šå’Œä½ç½®è¨˜éŒ„</p>
            </div>
        </div>
    </div>
{%endblock%} {%block card%}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
    {%for item in items%}
    <div class="col">
    <div class="card h-100 shadow-sm">
      {%if item.ItemPic%}
      <img
        src="{{ url_for('items.uploaded_file', filename=item.ItemPic) }}"
        class="card-img-top"
        alt="{{ item.ItemName }}"
        style="height: 200px; object-fit: cover"
      />
      {%else%}
      <div
        class="card-img-top bg-light d-flex align-items-center justify-content-center"
        style="height: 200px"
      >
        <i class="fas fa-image fa-3x text-muted"></i>
      </div>
      {%endif%}
            <div class="card-body">
        <h5 class="card-title">{{item.ItemName}}</h5>
        <p class="card-text text-muted">ID: {{item.ItemID}}</p>
        {%if item.ItemStorePlace%}
        <p class="card-text">
          <strong>ğŸ“ æ”¾ç½®åœ°é»:</strong> {{item.ItemStorePlace}}
        </p>
        {%endif%} 
        {%if item.ItemFloor or item.ItemRoom or item.ItemZone%}
        <p class="card-text">
          <strong>ğŸ  ä½ç½®å±¤ç´š:</strong> {{item.ItemFloor}} {{item.ItemRoom}} {{item.ItemZone}}
        </p>
        {%endif%}
        {%if item.ItemType%}
        <p class="card-text"><strong>ğŸ“‚ é¡å‹:</strong> {{item.ItemType}}</p>
        {%endif%} {%if item.ItemOwner%}
        <p class="card-text"><strong>ğŸ‘¤ æ“æœ‰è€…:</strong> {{item.ItemOwner}}</p>
        {%endif%} {%if item.ItemGetDate%}
        <p class="card-text">
          <strong>ğŸ“… å–å¾—æ—¥æœŸ:</strong> {{item.ItemGetDate}}
        </p>
        {%endif%}
        {%if item.WarrantyExpiry%}
        <p class="card-text">
          <strong>ğŸ›¡ ä¿å›ºæˆªæ­¢:</strong> {{item.WarrantyExpiry}}
          {% if item.WarrantyStatus=='expired' %}<span class="badge bg-danger ms-1">åˆ°æœŸ</span>{% elif item.WarrantyStatus=='near' %}<span class="badge bg-warning text-dark ms-1">å³å°‡åˆ°æœŸ</span>{% endif %}
        </p>
        {%endif%}
        {%if item.UsageExpiry%}
        <p class="card-text">
          <strong>âŒ› ä½¿ç”¨æœŸé™:</strong> {{item.UsageExpiry}}
          {% if item.UsageStatus=='expired' %}<span class="badge bg-danger ms-1">åˆ°æœŸ</span>{% elif item.UsageStatus=='near' %}<span class="badge bg-warning text-dark ms-1">å³å°‡åˆ°æœŸ</span>{% endif %}
        </p>
        {%endif%} {%if item.ItemDesc%}
        <p class="card-text">{{item.ItemDesc}}</p>
        {%endif%}
      </div>
      <div class="card-footer">
        <div class="d-flex justify-content-between align-items-center">
          <span class="badge bg-primary">ğŸ“¦ ç‰©å“</span>
          <form method="POST" style="display: inline">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="item_id" value="{{item.ItemID}}" />
            <input
              type="text"
              name="new_place"
              class="form-control form-control-sm d-inline-block"
              style="width: 150px"
              placeholder="æ›´æ–°ä½ç½®..."
            />
            <div class="d-flex mt-1">
              <select name="ItemFloor" class="form-select form-select-sm me-1">
                <option value="">æ¨“å±¤</option>
                {% for f in floors %}
                <option value="{{f}}">{{f}}</option>
                {% endfor %}
              </select>
              <select name="ItemRoom" class="form-select form-select-sm me-1">
                <option value="">æˆ¿é–“</option>
                {% for r in rooms %}
                <option value="{{r}}">{{r}}</option>
                {% endfor %}
              </select>
              <select name="ItemZone" class="form-select form-select-sm">
                <option value="">å€åŸŸ</option>
                {% for z in zones %}
                <option value="{{z}}">{{z}}</option>
                {% endfor %}
              </select>
            </div>
            <button type="submit" class="btn btn-success btn-sm ms-1">
              ğŸ“ æ›´æ–°ä½ç½®
            </button>
          </form>
        </div>
        <div class="mt-2">
          <a
            href="{{ url_for('items.edititem', item_id=item.ItemID) }}"
            class="btn btn-primary btn-sm"
            >âœï¸ ç·¨è¼¯</a
          >
          <a
            href="{{ url_for('items.search') }}?q={{item.ItemName}}"
            class="btn btn-info btn-sm"
            >ğŸ” æœå°‹ç›¸ä¼¼</a
          >
          <div class="btn-group btn-group-sm">
            <a class="btn btn-outline-secondary" href="{{ url_for('items.qrcode_image', item_id=item.ItemID) }}">QR</a>
            <a class="btn btn-outline-secondary" href="{{ url_for('items.barcode_image', item_id=item.ItemID) }}">æ¢ç¢¼</a>
          </div>
        </div>
            </div>
        </div>
    </div>
    {%endfor%}
</div>

{%if not items%}
<div class="text-center py-5">
  <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
  <h3 class="text-muted">é‚„æ²’æœ‰ä»»ä½•ç‰©å“</h3>
  <p class="text-muted">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹è¨˜éŒ„æ‚¨çš„ç¬¬ä¸€å€‹ç‰©å“å§ï¼</p>
  <a href="{{ url_for('items.additem') }}" class="btn btn-primary btn-lg"
    >â• æ–°å¢ç‰©å“</a
  >
</div>
{%endif%} {%endblock%} {%block page%}
{% include "partials/pagination.html" %}
{%endblock%} {%block js%}
<script>
  var myModal = new bootstrap.Modal(document.getElementById("modalEdit"));
    // var myModal = new bootstrap.Modal(document.getElementById('modalClone'));
  var items = "{{items}}"
    .replaceAll("&#39;", '"')
    .replaceAll("[", "")
    .replaceAll("]", "")
    .replaceAll("}, {", "}; {");
  console.log(items);
  var items = items.split(";");
    var itemtype = Array.from(document.getElementById("ItemType").options);
  items.forEach((item, index) => {
    items[index] = JSON.parse(item);
  });
  itemtype.forEach((type, index) => {
    itemtype[index] = type.innerText;
  });

    function edit(value) {
    document.getElementById("modaltitle").innerText = "Edit Item";
    document.getElementById("modalbutton").innerText = "Edit";
    document.getElementById("Mode").value = "Edit";
    items.forEach((i) => {
            if (i._id === value) {
                document.getElementById("_id").value = i._id;
                document.getElementById("ItemName").value = i.ItemName;
                document.getElementById("ItemID").value = i.ItemID;
                document.getElementById("ItemAge").value = i.ItemAge;
                document.getElementById("ItemGetDate").value = i.ItemGetDate;
                document.getElementById("ItemOwner").value = i.ItemOwner;
                document.getElementById("ItemStorePlace").value = i.ItemStorePlace;
        document.getElementById("ItemType").options[
          itemtype.indexOf(i.ItemType)
        ].selected = true;
                document.getElementById("ItemDesc").value = i.ItemDesc;
                myModal.toggle();
            }
        });
    }
</script>
{%endblock%}
